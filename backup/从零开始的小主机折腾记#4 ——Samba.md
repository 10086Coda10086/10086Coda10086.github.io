è¿›ä¸€æ­¥é…ç½®æˆNAS

## ä¸€ã€Sambaå¹²ä»€ä¹ˆ

1. **Linux ä¸Šæœ‰ä¸€ä¸ªçœŸå®å­˜åœ¨çš„ç›®å½•**ï¼ˆæ¯”å¦‚ `/data`ï¼‰
2. **Samba æŠŠè¿™ä¸ªç›®å½•â€œå…±äº«â€å‡ºå»**
3. **Windows é€šè¿‡ SMB åè®®è®¿é—®**

------

## äºŒã€ç¡®è®¤æ•°æ®ç›˜çŠ¶æ€ï¼ˆå¿…é¡»å…ˆå¯¹ï¼‰

### 2.1 ç¡®è®¤ `/data` å·²æŒ‚è½½

```
lsblk
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š

```
sdb
â””â”€sdb1  465G  /data
```

#### âŒ å¸¸è§é”™è¯¯

- **æ²¡çœ‹åˆ° `/data`**
  - è¯´æ˜æ²¡æŒ‚è½½æˆåŠŸ
  - Samba å…±äº«â€œç©ºæ°”â€ï¼ŒWindows ä¸€å®šè¿ä¸ä¸Š

ğŸ‘‰ å¦‚æœæ²¡æŒ‚è½½ï¼Œ**å…ˆåˆ«ç»§ç»­**

------

### 2.2 ç¡®è®¤ç›®å½•çœŸå®å­˜åœ¨

```
ls -ld /data
```

æ­£å¸¸ç¤ºä¾‹ï¼š

```
drwxr-xr-x 3 root root 4096 /data
```

------

## ä¸‰ã€å®‰è£… Sambaï¼ˆä»ç³»ç»Ÿå±‚å¼€å§‹ï¼‰

### 3.1 å®‰è£… Samba

```
sudo apt update
sudo apt install -y samba
```

å®‰è£…å®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡ã€‚

------

### 3.2 ç¡®è®¤ Samba æœåŠ¡çŠ¶æ€

```
systemctl status smbd
```

åº”çœ‹åˆ°ï¼š

```
Active: active (running)
```

#### âŒ å¸¸è§é”™è¯¯

- `inactive` / `failed`

  ```
  sudo systemctl start smbd
  sudo systemctl enable smbd
  ```

------

## å››ã€åˆ›å»ºâ€œä¸“ç”¨ Samba ç”¨æˆ·â€ï¼ˆå¼ºçƒˆæ¨èï¼‰

âš ï¸ **ä¸è¦ç”¨ root**
 âš ï¸ **ä¸è¦ç›´æ¥ç”¨ç³»ç»Ÿç”¨æˆ·ï¼ˆæ–°æ‰‹å®¹æ˜“æƒé™ä¹±ï¼‰**

#### 4.1 åˆ›å»ºä¸€ä¸ª NAS ç”¨æˆ·ï¼ˆç¤ºä¾‹å« nasï¼‰

```
sudo adduser nas
```

ä¸€è·¯æŒ‰å›è½¦å³å¯ï¼Œå¯†ç è®°ä½ã€‚

------

#### 4.2 æŠŠ `/data` çš„æ§åˆ¶æƒäº¤ç»™è¿™ä¸ªç”¨æˆ·

```
sudo chown -R nas:nas /data
sudo chmod -R 755 /data
```

è§£é‡Šï¼š

- `nas:nas` â†’ è¿™ä¸ªç”¨æˆ·èƒ½å®Œæ•´è¯»å†™
- `755` â†’ å…¶ä»–ç”¨æˆ·å¯è¯»ï¼Œä¸å¯ä¹±å†™

------

##### âŒ å¸¸è§é”™è¯¯

- Windows èƒ½çœ‹åˆ°æ–‡ä»¶ï¼Œä½†**åˆ ä¸äº† / æ–°å»ºä¸äº†**
  - 99% æ˜¯ Linux æƒé™é—®é¢˜
  - ç”¨çš„ä¸æ˜¯ `chown`

------

## äº”ã€ç»™ Samba åˆ›å»ºâ€œç™»å½•å¯†ç â€ï¼ˆå…³é”®ï¼‰

âš ï¸ **Samba ç”¨æˆ· â‰  Linux ç™»å½•ç”¨æˆ·**

### 5.1 æ·»åŠ  Samba ç”¨æˆ·

```
sudo smbpasswd -a nas
```

- è¾“å…¥å¯†ç ï¼ˆå¯ä»¥å’Œ Linux ç”¨æˆ·ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸åŒï¼‰
- å†è¾“å…¥ä¸€æ¬¡ç¡®è®¤

------

### 5.2 å¯ç”¨è¯¥ Samba ç”¨æˆ·

```
sudo smbpasswd -e nas
```

------

#### âŒ å¸¸è§é”™è¯¯

- Windows ä¸€ç›´æç¤ºâ€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€
  - å¿˜äº† `smbpasswd`
  - ä¸æ˜¯ Linux å¯†ç çš„é—®é¢˜ï¼Œæ˜¯ **Samba å¯†ç **

------

## å…­ã€é…ç½® Samba å…±äº«ï¼ˆæœ€æ ¸å¿ƒï¼‰

### 6.1 ç¼–è¾‘é…ç½®æ–‡ä»¶

```
sudo nano /etc/samba/smb.conf
```

æ»šåŠ¨åˆ°**æ–‡ä»¶æœ€åº•éƒ¨**ï¼Œè¿½åŠ ï¼š

```
[data]
   comment = Data Disk
   path = /data
   browseable = yes
   writable = yes
   valid users = nas
   force user = nas
   force group = nas
   create mask = 0664
   directory mask = 0775
```

### æ¯ä¸€é¡¹åœ¨å¹²ä»€ä¹ˆï¼ˆéå¸¸é‡è¦ï¼‰

| é…ç½®          | å«ä¹‰                   |
| ------------- | ---------------------- |
| `[data]`      | Windows é‡Œçœ‹åˆ°çš„å…±äº«å |
| `path`        | å®é™… Linux ç›®å½•        |
| `valid users` | åªå…è®¸ nas             |
| `force user`  | å¼ºåˆ¶ç”¨ nas å†™æ–‡ä»¶      |
| `browseable`  | Windows èƒ½çœ‹åˆ°         |
| `writable`    | å¯å†™                   |
| `mask`        | æ–°æ–‡ä»¶ / ç›®å½•æƒé™      |

------

### 6.2 æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

```
testparm
```

å¦‚æœæœ€åä¸€è¡Œæ˜¯ï¼š

```
Loaded services file OK.
```

è¯´æ˜é…ç½®æ²¡é—®é¢˜ã€‚

#### âŒ å¸¸è§é”™è¯¯

- å°‘äº†ç©ºæ ¼ / æ‹¼é”™å­—æ®µ
- ç”¨äº†ä¸­æ–‡ç¬¦å·

------

### 6.3 é‡å¯ Samba æœåŠ¡

```
sudo systemctl restart smbd
```

------

## ä¸ƒã€æœåŠ¡å™¨ç½‘ç»œæ£€æŸ¥ï¼ˆWindows è¿ä¸ä¸Šçš„å¤§å¤´ï¼‰

### 7.1 æŸ¥çœ‹æœåŠ¡å™¨ IP

```
ip a
```

ä¾‹å¦‚ï¼š

```
inet 192.168.1.100/24
```

è®°ä½è¿™ä¸ª IPã€‚

------

### 7.2 ç¡®è®¤é˜²ç«å¢™çŠ¶æ€ï¼ˆUbuntu å¸¸è§å‘ï¼‰

```
sudo ufw status
```

#### æƒ…å†µ Aï¼š`Status: inactive`

âœ… æ²¡é—®é¢˜

#### æƒ…å†µ Bï¼š`active`

```
sudo ufw allow samba
sudo ufw reload
```

å¦åˆ™ Windows ä¼š **èƒ½ ping é€šï¼Œä½†è¿ä¸ä¸Šå…±äº«**

------

## å…«ã€Windows ç«¯è¿æ¥ï¼ˆä¸¤ç§æ–¹å¼ï¼‰

### æ–¹æ³•ä¸€ï¼šèµ„æºç®¡ç†å™¨ï¼ˆæœ€ç›´è§‚ï¼‰

åœ¨åœ°å€æ è¾“å…¥ï¼š

```
\\192.168.1.100\data
```

å¼¹å‡ºç™»å½•æ¡†ï¼š

- ç”¨æˆ·åï¼š`nas`
- å¯†ç ï¼šä½ åˆšè®¾ç½®çš„ Samba å¯†ç 

------

### æ–¹æ³•äºŒï¼šæ˜ å°„ä¸ºç½‘ç»œé©±åŠ¨å™¨ï¼ˆæ¨èï¼‰

1. æ­¤ç”µè„‘ â†’ å³é”® â†’ æ˜ å°„ç½‘ç»œé©±åŠ¨å™¨

2. è·¯å¾„å¡«å†™ï¼š

   ```
   \\192.168.1.100\data
   ```

3. å‹¾é€‰ï¼š

   - ä½¿ç”¨å…¶ä»–å‡­æ®

4. è¾“å…¥ï¼š

   - ç”¨æˆ·åï¼š`nas`
   - å¯†ç ï¼šSamba å¯†ç 

------

## ä¹ã€Windows è¿ä¸ä¸Šçš„â€œç³»ç»Ÿæ€§æ’æŸ¥è¡¨â€

### â¶ èƒ½ pingï¼Œä¸èƒ½è®¿é—®

```
ping 192.168.1.100
```

èƒ½é€šä½†è®¿é—®å¤±è´¥ï¼š

- é˜²ç«å¢™æ²¡æ”¾è¡Œ Samba
- Samba æœåŠ¡æ²¡è¿è¡Œ
- smb.conf é…é”™

------

### â· æç¤ºâ€œæ‰¾ä¸åˆ°ç½‘ç»œè·¯å¾„â€

- IP å†™é”™
- ä¸åœ¨åŒä¸€å±€åŸŸç½‘
- Windows SMB æœåŠ¡è¢«ç¦ç”¨

#### Windows æ£€æŸ¥ SMB

æ§åˆ¶é¢æ¿ â†’ ç¨‹åº â†’ å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½
 âœ” å‹¾é€‰ **SMB 1.0/CIFSï¼ˆå¦‚è€ç³»ç»Ÿï¼‰**

------

### â¸ æç¤ºâ€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€

- ç”¨äº† Linux å¯†ç è€Œä¸æ˜¯ Samba å¯†ç 
- ç”¨æˆ·åå†™æˆ `nas@hostname`
- ä¹‹å‰è¾“é”™è¢« Windows è®°ä½äº†

ğŸ‘‰ æ¸…ç¼“å­˜ï¼š

```
net use * /delete
```

------

### â¹ èƒ½è¿›ä½†ä¸èƒ½å†™

- `/data` æƒé™ä¸å¯¹
- æ²¡ `force user`
- ç”¨ root åˆ›å»ºçš„æ–‡ä»¶

ğŸ‘‰ ä¿®å¤ï¼š

```
sudo chown -R nas:nas /data
```

------

## åã€ä½ ç°åœ¨çš„çŠ¶æ€åº”è¯¥æ˜¯

- `/data` æ˜¯ **sdb æœºæ¢°ç›˜**
- Windows èƒ½åƒâ€œç½‘ç»œç¡¬ç›˜â€ä¸€æ ·è®¿é—®
- NAS-Panel / Docker / qB éƒ½å¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªè·¯å¾„